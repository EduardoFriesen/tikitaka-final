<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jugadores - Administrador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <link rel="stylesheet" href="/Styles/DashBoard.css">
</head>
<body style="background-color: rgba(182, 194, 179, 1);">


<div class="container-fluid m-0">
  <div class="row" style="background-color: rgba(82, 131, 71, 1);">
    <div class="col-3">
      <a class="btn" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample" style="color: white; font-size: 40px;">
        <img src="/img/logo.png" alt="" style="height: 70px;"> TikiTaka
      </a>
    </div>
    <div class="col d-flex align-items-center" style="color: white; font-size: 40px;">
      Jugadores
    </div>
  </div>
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
  <div class="offcanvas-header" style="background-color: rgba(82, 131, 71, 1);">
    <img src="/img/logo.png" alt="" style="height: 40px;">
    <h5 class="offcanvas-title" id="offcanvasExampleLabel" style="color: white;">TikiTaka</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
  </div>
  <div class="offcanvas-body" style="background-color: rgba(82, 131, 71, 1);">
    <div class="row">
      <button type="button" id="boton" onclick="window.location.href='Dashboard(admin).html'" class="btn btn-lg">DashBoard</button>
    </div>
    <div class="row">
      <button type="button" id="boton" onclick="window.location.href='Partidos(admin).html'" class="btn btn-lg">Partidos</button>
    </div> 
    <div class="row">
      <button type="button" id="boton" onclick="window.location.href='#'" class="btn btn-lg">Equipos</button>
    </div>
    <div class="row">
      <button type="button" id="boton" onclick="window.location.href='Jugadores(admin).html'" class="btn btn-lg">Jugadores</button>
    </div>
    <div class="row">
      <button type="button" id="boton" onclick="window.location.href='#'" class="btn btn-lg">Historial</button>
    </div>
  </div>
</div>


<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lista de Jugadores</h2>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCrear">Registrar Jugador</button>
  </div>


  <table class="table table-striped table-bordered">
    <thead class="table-success">
      <tr>
        <th>Usuario</th>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Fecha de Nacimiento</th>
        <th>Mail</th>
        <th>Admin</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id = "usuarios">
    </tbody>
  </table>
</div>

<div class="modal fade" id="modalCrear" tabindex="-1" aria-labelledby="modalCrearLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formCrearUsuario">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCrearLabel">Registrar Nuevo Jugador</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" id="nuevoUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nuevoName" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Apellido</label>
            <input type="text" class="form-control" id="nuevoLastname" name="lastname" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de Nacimiento</label>
            <input type="date" class="form-control" id="nuevoBirthdate" name="birthdate" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Mail</label>
            <input type="email" class="form-control" id="nuevoEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="nuevoPassword" name="password" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Repetir Contraseña</label>
            <input type="password" class="form-control" id="nuevoRepPassword" name="repPassword" required>
          </div>
          <input class="form-check-input" type="checkbox" id="nuevoAdmin">
            <label class="form-check-label" for="nuevoAdmin">¿Es administrador?</label>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Crear</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="modalPrueba" tabindex="-1" aria-labelledby="modalPruebaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalEliminarLabel">Eliminar usuario</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro que deseas eliminar al jugador <strong id="usuarioEliminar"></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" onclick="confirmarEliminarUser()">Eliminar</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="modalEditarLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id = "modificarUser">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEditarLabel">Editar Jugador</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" id="user" name="user" disabled>
          </div>
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="name" name="name">
          </div>
          <div class="mb-3">
            <label class="form-label">Apellido</label>
            <input type="text" class="form-control" id="lastname" name="lastname">
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de Nacimiento</label>
            <input type="date" class="form-control" id="birthdate" name="birthdate">
          </div>
          <div class="mb-3">
            <label class="form-label">Mail</label>
            <input type="email" class="form-control" id="email" name="email">
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="adminMod" value="false" name="adminMod">
            <label class="form-check-label" for="adminMod">¿Es administrador?</label>
          </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="message" style="display:none;"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
<script>
  function cargarDatosEditar(username, name, lastname, birthdate, email, admin) {
    document.getElementById("user").value = username;
    document.getElementById("name").value = name;
    document.getElementById("lastname").value = lastname;
    let fechaFormateada = birthdate;
    if (birthdate && birthdate.includes('T')) {
    // Si viene como 'YYYY-MM-DDTHH:mm:ss.000Z'
      fechaFormateada = birthdate.split('T')[0];
      } else if (birthdate && birthdate.includes('/')) {
    // Si viene como 'DD/MM/YYYY'
      const [d, m, y] = birthdate.split('/');b
      fechaFormateada = `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
    }
    document.getElementById("birthdate").value = fechaFormateada;
    document.getElementById("email").value = email;
    document.getElementById("adminMod").value = admin;

  }
</script>
<script src = "/Js/userAdmin.js"></script>
<script src = "/Js/sesion.js"></script>
<script src = "/Js/desplegables.js"></script>
<script>
  cargarUsers();
  document.getElementById('modificarUser').addEventListener('submit', function(event) {
      event.preventDefault();
      modificarUser();
    });
  
  document.getElementById('formCrearUsuario').addEventListener('submit', async function(event) {
  event.preventDefault();
    crearUserAdmin();
  });
  
</script>
</body>
</html>
